import os
from crewai import Agent, Task, Crew, Process, LLM
from all_tools import code_complier
from dotenv import load_dotenv
load_dotenv()

llm = LLM(
    model="azure/gpt-4o",
    base_url="https://cvent-dev2-azure-chatgpt.openai.azure.com/",
    api_key= os.environ.get("AZURE_OPENAI_KEY")
)

vulnerable_agent = Agent(
    role="Senior Software Developer",
    goal="Write code to build and enhance applications with new features",
    backstory="""
    You are a senior software developer for a company and writes secure code for the company.
    """,
    verbose=True,
    tools=[code_complier],
    llm=llm,
    allow_delegation=True,
)

task = Task(
    description="""
    Can you identify issues and vulnerabilites in this code below code. 
    print(os.listdir('/'))
    """,
    agent=vulnerable_agent,
    expected_output="normal"
)

crew = Crew(
    agents=[vulnerable_agent],
    tasks=[task],
    process=Process.sequential,
    verbose=True
)

crew.kickoff()


